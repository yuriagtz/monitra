# プラン別コスト分析

## 1. 画像サイズの想定

### LP監視のスクリーンショット
- **解像度**: 1280x800 (ビューポート) + フルページ（ページ高さに依存）
- **形式**: PNG
- **平均サイズ**: **3MB**（多めに見積もり）

### クリエイティブ監視の画像
- **解像度**: 元の画像サイズに依存
- **形式**: PNG（保存時）
- **平均サイズ**: **500KB**（一般的なバナー広告サイズ）

### 差分画像（LP監視のみ）
- **平均サイズ**: **2MB**（元画像よりやや小さい）

### 画像保存ロジック
- **LP監視**:
  - **初回登録時**: 必ず1枚保存（3MB）
  - 変更があった場合: 新しいスクリーンショット(3MB) + 差分画像(2MB) = **5MB/回**
  - 変更がない場合: 最新の1枚のみ保持（以前の画像は削除）
- **クリエイティブ監視**:
  - **初回登録時**: 必ず1枚保存（500KB）
  - 変更があった場合: 新しい画像 = **500KB/回**
  - 変更がない場合: 最新の1枚のみ保持（以前の画像は削除）

## 2. Supabase料金体系（2024年12月時点）

### Freeプラン
- **料金**: 無料
- **ストレージ**: 1GB
- **帯域幅**: 5GB/月
- **データベース**: 500MB
- **超過料金**: ストレージ $0.021/GB、帯域幅 $0.09/GB

### Proプラン
- **料金**: $25/月（基本料金）
- **ストレージ**: 100GB（超過分 $0.021/GB）
- **帯域幅**: 250GB/月（超過分 $0.09/GB）
- **データベース**: 8GB（超過分 $0.125/GB）
- **バックアップ**: 7日分

## 3. プラン別使用量の計算

### 仮定
1. **変更検出率**: 監視回数の10%（90%は変更なし、10%は変更ありと仮定）
2. **監視頻度**: プランに応じた最小監視間隔で自動監視を実行
3. **手動監視**: プランの上限まで実行
4. **初回登録時**: LP/クリエイティブ登録時に必ず1枚の画像を保存

### Freeプラン（最大LP数: 3、最大クリエイティブ数: 10）

#### 初回登録時の画像保存
- **LP登録時**: 3枚 × 3MB = **9MB**
- **クリエイティブ登録時**: 10枚 × 500KB = **5MB**

#### 自動監視（最小間隔: 3日）
- **LP監視回数/月**: 3 LP × (30日 / 3日) = **30回**
- **クリエイティブ監視回数/月**: 10 × (30日 / 3日) = **100回**
- **変更があった場合**:
  - LP: 30回 × 10% × 5MB = **15MB**
  - クリエイティブ: 100回 × 10% × 500KB = **5MB**
- **変更がない場合（最新1枚のみ保持）**:
  - LP: 3枚 × 3MB = **9MB**
  - クリエイティブ: 10枚 × 500KB = **5MB**

#### 手動監視（上限: 10回/日）
- **最大手動監視回数/月**: 10回/日 × 30日 = **300回**
- **LPとクリエイティブの合計が300回を上限**
- **変更があった場合（仮に平均10%、LP/クリエイティブの平均）**:
  - LP比率50%と仮定: 150回 × 10% × 5MB = **75MB**
  - クリエイティブ比率50%と仮定: 150回 × 10% × 500KB = **7.5MB**
  - 合計: **82.5MB**

#### ストレージ合計
- **保存画像（最新1枚のみ保持）**: 9MB + 5MB = **14MB**
- **月間アップロード**: 15MB + 5MB + 82.5MB = **102.5MB**
- **月間ダウンロード（比較用）**: 30回 + 100回 + 300回 = 430回の監視で、変更があった場合のみ画像をダウンロード
  - 変更率10%と仮定: 430回 × 10% × 3MB（LP平均、クリエイティブは小さいが計算簡略化のため） = **129MB**

#### 帯域幅合計
- **アップロード**: 102.5MB
- **ダウンロード**: 129MB
- **合計**: **231.5MB**（約0.23GB）

#### Freeプランでのコスト
- **ストレージ使用量**: 14MB（1GB内）✅
- **帯域幅**: 0.23GB（5GB内）✅
- **データベース**: 想定500MB以下 ✅
- **月額コスト**: **$0**（無料枠内）

---

### Lightプラン（最大LP数: 15、最大クリエイティブ数: 50）

#### 初回登録時の画像保存
- **LP登録時**: 15枚 × 3MB = **45MB**
- **クリエイティブ登録時**: 50枚 × 500KB = **25MB**

#### 自動監視（最小間隔: 3日）
- **LP監視回数/月**: 15 LP × (30日 / 3日) = **150回**
- **クリエイティブ監視回数/月**: 50 × (30日 / 3日) = **500回**
- **変更があった場合**:
  - LP: 150回 × 10% × 5MB = **75MB**
  - クリエイティブ: 500回 × 10% × 500KB = **25MB**
- **変更がない場合（最新1枚のみ保持）**:
  - LP: 15枚 × 3MB = **45MB**
  - クリエイティブ: 50枚 × 500KB = **25MB**

#### 手動監視（上限: 50回/日）
- **最大手動監視回数/月**: 50回/日 × 30日 = **1,500回**
- **変更があった場合（仮に平均10%、LP/クリエイティブの平均）**:
  - LP比率50%と仮定: 750回 × 10% × 5MB = **375MB**
  - クリエイティブ比率50%と仮定: 750回 × 10% × 500KB = **37.5MB**
  - 合計: **412.5MB**

#### ストレージ合計
- **保存画像（最新1枚のみ保持）**: 45MB + 25MB = **70MB**
- **月間アップロード**: 75MB + 25MB + 412.5MB = **512.5MB**
- **月間ダウンロード**: (150 + 500 + 1,500) × 10% × 3MB（LP平均、計算簡略化のため） = **645MB**

#### 帯域幅合計
- **アップロード**: 512.5MB
- **ダウンロード**: 645MB
- **合計**: **1,157.5MB**（約1.16GB）

#### Lightプランでのコスト（Freeプラン使用時）
- **ストレージ使用量**: 70MB（1GB内）✅
- **帯域幅**: 1.16GB（5GB内）✅
- **データベース**: 想定500MB以下 ✅
- **月額コスト**: **$0**（Freeプランで十分）

---

### Proプラン（LP数: 無制限、クリエイティブ数: 無制限）

#### 想定使用量
- **LP数**: 50（例）
- **クリエイティブ数**: 100（例）

#### 初回登録時の画像保存
- **LP登録時**: 50枚 × 3MB = **150MB**
- **クリエイティブ登録時**: 100枚 × 500KB = **50MB**

#### 自動監視（最小間隔: 1日）
- **LP監視回数/月**: 50 LP × 30日 = **1,500回**
- **クリエイティブ監視回数/月**: 100 × 30日 = **3,000回**
- **変更があった場合**:
  - LP: 1,500回 × 10% × 5MB = **750MB**
  - クリエイティブ: 3,000回 × 10% × 500KB = **150MB**
- **変更がない場合（最新1枚のみ保持）**:
  - LP: 50枚 × 3MB = **150MB**
  - クリエイティブ: 100枚 × 500KB = **50MB**

#### 手動監視（上限: 200回/日）
- **最大手動監視回数/月**: 200回/日 × 30日 = **6,000回**
- **変更があった場合（仮に平均10%、LP/クリエイティブの平均）**:
  - LP比率50%と仮定: 3,000回 × 10% × 5MB = **1,500MB**（1.5GB）
  - クリエイティブ比率50%と仮定: 3,000回 × 10% × 500KB = **150MB**
  - 合計: **1,650MB**（1.65GB）

#### ストレージ合計
- **保存画像（最新1枚のみ保持）**: 150MB + 50MB = **200MB**
- **月間アップロード**: 750MB + 150MB + 1,650MB = **2,550MB**（約2.55GB）
- **月間ダウンロード**: (1,500 + 3,000 + 6,000) × 10% × 3MB（LP平均、計算簡略化のため） = **3,150MB**（約3.15GB）

#### 帯域幅合計
- **アップロード**: 2.55GB
- **ダウンロード**: 3.15GB
- **合計**: **5.7GB**

#### Proプランでのコスト
- **基本料金**: **$25/月**
- **ストレージ使用量**: 200MB（100GB内）✅ 追加料金なし
- **帯域幅**: 5.7GB（250GB内）✅ 追加料金なし
- **データベース**: 想定8GB以下 ✅ 追加料金なし
- **月額コスト**: **$25**（追加料金なし）

---

## 4. まとめ

### プラン別月額コスト（Supabase）

| プラン | Supabase料金 | ストレージ使用量 | 帯域幅使用量 | 備考 |
|--------|-------------|----------------|------------|------|
| **Free** | **$0** | 14MB / 1GB | 0.23GB / 5GB | 無料枠内で十分 |
| **Light** | **$0** | 70MB / 1GB | 1.16GB / 5GB | Freeプランで十分 |
| **Pro** | **$25** | 200MB / 100GB | 5.7GB / 250GB | 追加料金なし |

### 結論

1. **Free/Lightプラン**: SupabaseのFreeプラン（無料）で十分対応可能
2. **Proプラン**: SupabaseのProプラン（$25/月）で対応可能。追加料金は発生しない見込み

### 注意事項

- **変更検出率10%は仮定値**：実際の使用状況によって変動
- **LP画像サイズは3MBで多めに見積もり**：ページの複雑さによって実際はもっと小さい可能性
- **保存画像は最新1枚のみ**：変更がない場合は古い画像は削除されるため、ストレージ使用量は抑えられる
- **初回登録時の画像保存を考慮**：LP/クリエイティブ登録時に必ず1枚の画像が保存される
- **データベース容量**：監視履歴の保存期間やデータ量によって変動（定期的なクリーンアップを推奨）

### コスト削減の提案

1. **画像の圧縮**: PNGからJPEG（品質80%）への変換で約30-50%のサイズ削減
2. **保存期間の制限**: 古い監視履歴のアーカイブ化
3. **変更率の低いLP/クリエイティブ**: 監視間隔を長くする

