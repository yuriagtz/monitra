# プラン別コスト分析

## 1. 画像サイズの想定

### LP監視のスクリーンショット
- **解像度**: 1280x800 (ビューポート) + フルページ（ページ高さに依存）
- **形式**: **JPEG**（品質80%、実装済み）
- **平均サイズ**: **1.5MB**（元のPNG 3MBから約50%削減）

### クリエイティブ監視の画像
- **解像度**: 元の画像サイズに依存
- **形式**: **JPEG**（品質80%、実装済み）
- **平均サイズ**: **250KB**（元のPNG 500KBから約50%削減）

### 差分画像（LP監視のみ）
- **形式**: **JPEG**（品質80%、実装済み）
- **平均サイズ**: **1MB**（元のPNG 2MBから約50%削減）

### 画像保存ロジック
- **LP監視**:
  - **初回登録時**: 必ず1枚保存（1.5MB）
  - 変更があった場合: 新しいスクリーンショット(1.5MB) + 差分画像(1MB) = **2.5MB/回**
  - 変更がない場合: 最新の1枚のみ保持（以前の画像は削除）
- **クリエイティブ監視**:
  - **初回登録時**: 必ず1枚保存（250KB）
  - 変更があった場合: 新しい画像 = **250KB/回**
  - 変更がない場合: 最新の1枚のみ保持（以前の画像は削除）

## 2. Supabase料金体系（2024年12月時点）

### Freeプラン
- **料金**: 無料
- **ストレージ**: 1GB
- **帯域幅**: 5GB/月
- **データベース**: 500MB
- **超過料金**: ストレージ $0.021/GB、帯域幅 $0.09/GB

### Proプラン
- **料金**: $25/月（基本料金）
- **ストレージ**: 100GB（超過分 $0.021/GB）
- **帯域幅**: 250GB/月（超過分 $0.09/GB）
- **データベース**: 8GB（超過分 $0.125/GB）
- **バックアップ**: 7日分

## 3. プラン別使用量の計算

### 仮定
1. **変更検出率**: 監視回数の10%（90%は変更なし、10%は変更ありと仮定）
2. **監視頻度**: プランに応じた最小監視間隔で自動監視を実行
   - Free: 14日ごと
   - Light: 7日ごと
   - Pro: 3日ごと
3. **手動監視**: プランの上限まで実行
   - Free: 5回/日
   - Light: 50回/日
   - Pro: 200回/日
4. **初回登録時**: LP/クリエイティブ登録時に必ず1枚の画像を保存
5. **保存期間**: プランに応じた履歴保持期間が経過した古いデータは自動削除
   - Free: 30日
   - Light: 90日
   - Pro: 365日

### Freeプラン（最大LP数: 3、最大クリエイティブ数: 10、最小間隔: 14日、手動監視: 5回/日）

#### 初回登録時の画像保存
- **LP登録時**: 3枚 × 1.5MB = **4.5MB**
- **クリエイティブ登録時**: 10枚 × 250KB = **2.5MB**

#### 自動監視（最小間隔: 14日）
- **LP監視回数/月**: 3 LP × (30日 / 14日) ≈ **6回**（2.14回/LP、切り上げ）
- **クリエイティブ監視回数/月**: 10 × (30日 / 14日) ≈ **21回**（2.1回/クリエイティブ）
- **変更があった場合**:
  - LP: 6回 × 10% × 2.5MB = **1.5MB**
  - クリエイティブ: 21回 × 10% × 250KB ≈ **0.5MB**
- **変更がない場合（最新1枚のみ保持）**:
  - LP: 3枚 × 1.5MB = **4.5MB**
  - クリエイティブ: 10枚 × 250KB = **2.5MB**

#### 手動監視（上限: 5回/日）
- **最大手動監視回数/月**: 5回/日 × 30日 = **150回**
- **LPとクリエイティブの合計が150回を上限**
- **変更があった場合（仮に平均10%、LP/クリエイティブの平均）**:
  - LP比率50%と仮定: 75回 × 10% × 2.5MB ≈ **18.75MB**
  - クリエイティブ比率50%と仮定: 75回 × 10% × 250KB ≈ **1.875MB**
  - 合計: **約20.6MB**

#### ストレージ合計
- **保存画像（最新1枚のみ保持）**: 4.5MB + 2.5MB = **7MB**
- **月間アップロード**: 1.5MB + 0.5MB + 20.6MB = **22.6MB**
- **月間ダウンロード（比較用）**: 6回 + 21回 + 150回 = 177回の監視で、変更があった場合のみ画像をダウンロード
  - 変更率10%と仮定: 177回 × 10% × 1.5MB（LP平均、クリエイティブは小さいが計算簡略化のため） ≈ **26.6MB**

#### 帯域幅合計
- **アップロード**: 22.6MB
- **ダウンロード**: 26.6MB
- **合計**: **49.2MB**（約0.05GB）

#### データベース容量（監視履歴）
- **月間監視回数**: 6回 + 21回 + 150回 = **177回**
- **1レコードあたりのサイズ**: 約2KB（ID、ユーザーID、LP/クリエイティブID、ステータス、メッセージ、URL、タイムスタンプなど）
- **月間データベース増加**: 177回 × 2KB = **354KB**
- **保存期間**: 30日
- **最大データベースサイズ（監視履歴のみ）**: 177回 × 30日 × 2KB ≈ **10.6MB**
- **その他データ（ユーザー、LP、クリエイティブ、設定など）**: 約50MB/アカウント（想定）
- **合計**: **約60.6MB/アカウント**

#### Freeプランでのコスト（1アカウントあたり）
- **ストレージ使用量**: 7MB（基本枠内）
- **帯域幅**: 0.05GB（基本枠内）
- **データベース**: 60.6MB（基本枠内）
- **月額コスト**: **$0**（無料枠内）

---

### Lightプラン（最大LP数: 10、最大クリエイティブ数: 30、最小間隔: 7日、手動監視: 50回/日）

#### 初回登録時の画像保存
- **LP登録時**: 10枚 × 1.5MB = **15MB**
- **クリエイティブ登録時**: 30枚 × 250KB = **7.5MB**

#### 自動監視（最小間隔: 7日）
- **LP監視回数/月**: 10 LP × (30日 / 7日) ≈ **43回**（4.3回/LP）
- **クリエイティブ監視回数/月**: 30 × (30日 / 7日) ≈ **129回**（4.3回/クリエイティブ）
- **変更があった場合**:
  - LP: 43回 × 10% × 2.5MB ≈ **10.75MB**
  - クリエイティブ: 129回 × 10% × 250KB ≈ **3.225MB**
- **変更がない場合（最新1枚のみ保持）**:
  - LP: 10枚 × 1.5MB = **15MB**
  - クリエイティブ: 30枚 × 250KB = **7.5MB**

#### 手動監視（上限: 50回/日）
- **最大手動監視回数/月**: 50回/日 × 30日 = **1,500回**
- **変更があった場合（仮に平均10%、LP/クリエイティブの平均）**:
  - LP比率50%と仮定: 750回 × 10% × 2.5MB = **187.5MB**
  - クリエイティブ比率50%と仮定: 750回 × 10% × 250KB ≈ **18.75MB**
  - 合計: **約206.25MB**

#### ストレージ合計
- **保存画像（最新1枚のみ保持）**: 15MB + 7.5MB = **22.5MB**
- **月間アップロード**: 10.75MB + 3.225MB + 206.25MB ≈ **220.2MB**
- **月間ダウンロード**: (43 + 129 + 1,500) × 10% × 1.5MB（LP平均、計算簡略化のため） ≈ **250.8MB**

#### 帯域幅合計
- **アップロード**: 220.2MB
- **ダウンロード**: 250.8MB
- **合計**: **471MB**（約0.47GB）

#### データベース容量（監視履歴）
- **月間監視回数**: 43回 + 129回 + 1,500回 = **1,672回**
- **1レコードあたりのサイズ**: 約2KB
- **月間データベース増加**: 1,672回 × 2KB = **3.34MB**
- **保存期間**: 90日
- **最大データベースサイズ（監視履歴のみ）**: 1,672回 × 90日 × 2KB ≈ **300MB**
- **その他データ**: 約100MB/アカウント（想定）
- **合計**: **約400MB/アカウント**

#### Lightプランでのコスト（1アカウントあたり）
- **ストレージ使用量**: 22.5MB（基本枠内）
- **帯域幅**: 0.47GB（基本枠内）
- **データベース**: 400MB（基本枠内）
- **月額コスト**: **$0**（Freeプランで十分）

---

### Proプラン（最大LP数: 100、最大クリエイティブ数: 300、最小間隔: 3日、手動監視: 200回/日）

#### 想定使用量（上限いっぱい）
- **LP数**: 100（上限いっぱい）
- **クリエイティブ数**: 300（上限いっぱい）

#### 初回登録時の画像保存
- **LP登録時**: 100枚 × 1.5MB = **150MB**
- **クリエイティブ登録時**: 300枚 × 250KB = **75MB**

#### 自動監視（最小間隔: 3日）
- **LP監視回数/月**: 100 LP × (30日 / 3日) = **1,000回**
- **クリエイティブ監視回数/月**: 300 × (30日 / 3日) = **3,000回**
- **変更があった場合**:
  - LP: 1,000回 × 10% × 2.5MB = **250MB**
  - クリエイティブ: 3,000回 × 10% × 250KB = **75MB**
- **変更がない場合（最新1枚のみ保持）**:
  - LP: 100枚 × 1.5MB = **150MB**
  - クリエイティブ: 300枚 × 250KB = **75MB**

#### 手動監視（上限: 200回/日）
- **最大手動監視回数/月**: 200回/日 × 30日 = **6,000回**
- **変更があった場合（仮に平均10%、LP/クリエイティブの平均）**:
  - LP比率50%と仮定: 3,000回 × 10% × 2.5MB = **750MB**
  - クリエイティブ比率50%と仮定: 3,000回 × 10% × 250KB = **75MB**
  - 合計: **825MB**

#### ストレージ合計
- **保存画像（最新1枚のみ保持）**: 150MB + 75MB = **225MB**
- **月間アップロード**: 250MB + 75MB + 825MB = **1,150MB**（約1.15GB）
- **月間ダウンロード**: (1,000 + 3,000 + 6,000) × 10% × 1.5MB（LP平均、計算簡略化のため） = **1,500MB**（約1.5GB）

#### 帯域幅合計
- **アップロード**: 1.15GB
- **ダウンロード**: 1.5GB
- **合計**: **2.65GB**

#### データベース容量（監視履歴）
- **月間監視回数**: 1,000回 + 3,000回 + 6,000回 = **10,000回**
- **1レコードあたりのサイズ**: 約2KB
- **月間データベース増加**: 10,000回 × 2KB = **20MB**
- **保存期間**: 365日
- **最大データベースサイズ（監視履歴のみ）**: 10,000回 × 365日 × 2KB ≈ **7.3GB**
- **その他データ**: 約500MB/アカウント（想定）
- **合計**: **約7.8GB/アカウント**

#### Proプランでのコスト（1アカウントあたり）
- **ストレージ使用量**: 225MB（基本枠内）
- **帯域幅**: 2.65GB（基本枠内）
- **データベース**: 7.8GB（基本枠内）
- **月額コスト**: **基本枠内**

---

### Adminプラン（LP数: 無制限、クリエイティブ数: 無制限、最小間隔: 1日、手動監視: 無制限）

#### 想定使用量（大規模運用の例）
- **LP数**: 200（例）
- **クリエイティブ数**: 500（例）

#### 初回登録時の画像保存
- **LP登録時**: 200枚 × 1.5MB = **300MB**
- **クリエイティブ登録時**: 500枚 × 250KB = **125MB**

#### 自動監視（最小間隔: 1日）
- **LP監視回数/月**: 200 LP × 30日 = **6,000回**
- **クリエイティブ監視回数/月**: 500 × 30日 = **15,000回**
- **変更があった場合**:
  - LP: 6,000回 × 10% × 2.5MB = **1,500MB**（1.5GB）
  - クリエイティブ: 15,000回 × 10% × 250KB = **375MB**
- **変更がない場合（最新1枚のみ保持）**:
  - LP: 200枚 × 1.5MB = **300MB**
  - クリエイティブ: 500枚 × 250KB = **125MB**

#### 手動監視（上限: 無制限）
- **想定手動監視回数/月**: 500回/日 × 30日 = **15,000回**（例）
- **変更があった場合（仮に平均10%、LP/クリエイティブの平均）**:
  - LP比率50%と仮定: 7,500回 × 10% × 2.5MB = **1,875MB**（約1.88GB）
  - クリエイティブ比率50%と仮定: 7,500回 × 10% × 250KB = **187.5MB**
  - 合計: **約2.06GB**

#### ストレージ合計
- **保存画像（最新1枚のみ保持）**: 300MB + 125MB = **425MB**
- **月間アップロード**: 1,500MB + 375MB + 2,060MB = **3,935MB**（約3.94GB）
- **月間ダウンロード**: (6,000 + 15,000 + 15,000) × 10% × 1.5MB（LP平均、計算簡略化のため） = **5,400MB**（約5.4GB）

#### 帯域幅合計
- **アップロード**: 3.94GB
- **ダウンロード**: 5.4GB
- **合計**: **9.34GB**

#### データベース容量（監視履歴）
- **月間監視回数**: 6,000回 + 15,000回 + 15,000回 = **36,000回**
- **1レコードあたりのサイズ**: 約2KB
- **月間データベース増加**: 36,000回 × 2KB = **72MB**
- **保存期間**: 無制限（削除しない）
- **データベース増加**: 継続的に増加（年間: 72MB × 12 = 864MB）
- **その他データ**: 約1GB/アカウント（想定）
- **初年度合計**: **約1.86GB/アカウント**（ただし無制限のため長期運用ではさらに増加）

#### Adminプランでのコスト（1アカウントあたり）
- **ストレージ使用量**: 425MB（基本枠内）
- **帯域幅**: 9.34GB（基本枠内）
- **データベース**: 1.86GB（初年度、基本枠内）
- **月額コスト**: **基本枠内**（中規模運用時）

**注意**: Adminプランは大規模運用を想定しているため、実際の使用量によってはSupabase Proプランの制限を超える可能性があります。その場合は、Supabase Teamプラン（$599/月）へのアップグレードを検討する必要があります。

---

## 4. プラン別の超過コスト計算（全リソース超過時）

### Supabase Proプランの基本枠
- **ストレージ**: 100GB
- **帯域幅**: 250GB/月
- **データベース**: 8GB

### 超過料金（2024年12月時点）
- **ストレージ**: $0.021/GB
- **帯域幅**: $0.09/GB
- **データベース**: $0.125/GB

### 各プランの1アカウントあたりの使用量

| プラン | ストレージ/アカウント | 帯域幅/アカウント/月 | データベース/アカウント |
|--------|---------------------|-------------------|---------------------|
| **Free** | 7MB (0.007GB) | 0.05GB | 60.6MB (0.0606GB) |
| **Light** | 22.5MB (0.0225GB) | 0.47GB | 400MB (0.4GB) |
| **Pro** | 225MB (0.225GB) | 2.65GB | 7.8GB |
| **Admin** | 425MB (0.425GB) | 9.34GB | 1.86GB（初年度） |

### 全リソースを超過するために必要なアカウント数

各プラン単独で、ストレージ・帯域幅・データベースの全てを超過するために必要なアカウント数を計算します。

#### Freeプラン

**基本枠を超過するために必要なアカウント数:**
- **ストレージ**: 100GB ÷ 0.007GB = **約14,286アカウント**
- **帯域幅**: 250GB ÷ 0.05GB = **5,000アカウント**
- **データベース**: 8GB ÷ 0.0606GB = **約132アカウント**

**最大のボトルネック: データベース（132アカウント）**

**132アカウントでの合計使用量:**
- **ストレージ**: 132 × 0.007GB = **0.924GB**（基本枠100GB内）✅
- **帯域幅**: 132 × 0.05GB = **6.6GB**（基本枠250GB内）✅
- **データベース**: 132 × 0.0606GB = **8GB**（基本枠8GBと同額）⏱️

**全リソースを超過するためには、データベースがボトルネックなので、133アカウント以上で全てを超過:**

**133アカウントでの合計使用量:**
- **ストレージ**: 133 × 0.007GB = **0.931GB**（基本枠100GB内）✅
- **帯域幅**: 133 × 0.05GB = **6.65GB**（基本枠250GB内）✅
- **データベース**: 133 × 0.0606GB = **8.06GB**（基本枠8GBを超過）❌

**133アカウントでの超過コスト:**
- **ストレージ超過**: 0GB（基本枠内）
- **帯域幅超過**: 0GB（基本枠内）
- **データベース超過**: (8.06GB - 8GB) × $0.125 = **$0.0075/月**

**1アカウントあたりの超過コスト: $0.0075 ÷ 133 = $0.000056/アカウント/月**

---

#### Lightプラン

**基本枠を超過するために必要なアカウント数:**
- **ストレージ**: 100GB ÷ 0.0225GB = **約4,444アカウント**
- **帯域幅**: 250GB ÷ 0.47GB = **約532アカウント**
- **データベース**: 8GB ÷ 0.4GB = **20アカウント**

**最大のボトルネック: データベース（20アカウント）**

**20アカウントでの合計使用量:**
- **ストレージ**: 20 × 0.0225GB = **0.45GB**（基本枠100GB内）✅
- **帯域幅**: 20 × 0.47GB = **9.4GB**（基本枠250GB内）✅
- **データベース**: 20 × 0.4GB = **8GB**（基本枠8GBと同額）⏱️

**全リソースを超過するためには、データベースがボトルネックなので、21アカウント以上で全てを超過:**

**21アカウントでの合計使用量:**
- **ストレージ**: 21 × 0.0225GB = **0.473GB**（基本枠100GB内）✅
- **帯域幅**: 21 × 0.47GB = **9.87GB**（基本枠250GB内）✅
- **データベース**: 21 × 0.4GB = **8.4GB**（基本枠8GBを超過）❌

**21アカウントでの超過コスト:**
- **ストレージ超過**: 0GB（基本枠内）
- **帯域幅超過**: 0GB（基本枠内）
- **データベース超過**: (8.4GB - 8GB) × $0.125 = **$0.05/月**

**1アカウントあたりの超過コスト: $0.05 ÷ 21 = $0.00238/アカウント/月**

---

#### Proプラン

**基本枠を超過するために必要なアカウント数:**
- **ストレージ**: 100GB ÷ 0.225GB = **約444アカウント**
- **帯域幅**: 250GB ÷ 2.65GB = **約94アカウント**
- **データベース**: 8GB ÷ 7.8GB = **約1.03アカウント**（1アカウントでほぼ8GB）

**最大のボトルネック: データベース（1アカウントでほぼ上限）**

**1アカウントでの合計使用量:**
- **ストレージ**: 1 × 0.225GB = **0.225GB**（基本枠100GB内）✅
- **帯域幅**: 1 × 2.65GB = **2.65GB**（基本枠250GB内）✅
- **データベース**: 1 × 7.8GB = **7.8GB**（基本枠8GB内）✅

**2アカウントでの合計使用量（全リソースを超過）:**
- **ストレージ**: 2 × 0.225GB = **0.45GB**（基本枠100GB内）✅
- **帯域幅**: 2 × 2.65GB = **5.3GB**（基本枠250GB内）✅
- **データベース**: 2 × 7.8GB = **15.6GB**（基本枠8GBを超過）❌

**2アカウントでの超過コスト:**
- **ストレージ超過**: 0GB（基本枠内）
- **帯域幅超過**: 0GB（基本枠内）
- **データベース超過**: (15.6GB - 8GB) × $0.125 = **$0.95/月**

**1アカウントあたりの超過コスト: $0.95 ÷ 2 = $0.475/アカウント/月**

---

#### Adminプラン

**基本枠を超過するために必要なアカウント数:**
- **ストレージ**: 100GB ÷ 0.425GB = **約235アカウント**
- **帯域幅**: 250GB ÷ 9.34GB = **約27アカウント**
- **データベース**: 8GB ÷ 1.86GB = **約4.3アカウント**

**最大のボトルネック: データベース（4.3アカウント）**

**4アカウントでの合計使用量:**
- **ストレージ**: 4 × 0.425GB = **1.7GB**（基本枠100GB内）✅
- **帯域幅**: 4 × 9.34GB = **37.36GB**（基本枠250GB内）✅
- **データベース**: 4 × 1.86GB = **7.44GB**（基本枠8GB内）✅

**5アカウントでの合計使用量（全リソースを超過）:**
- **ストレージ**: 5 × 0.425GB = **2.125GB**（基本枠100GB内）✅
- **帯域幅**: 5 × 9.34GB = **46.7GB**（基本枠250GB内）✅
- **データベース**: 5 × 1.86GB = **9.3GB**（基本枠8GBを超過）❌

**5アカウントでの超過コスト:**
- **ストレージ超過**: 0GB（基本枠内）
- **帯域幅超過**: 0GB（基本枠内）
- **データベース超過**: (9.3GB - 8GB) × $0.125 = **$0.1625/月**

**1アカウントあたりの超過コスト: $0.1625 ÷ 5 = $0.0325/アカウント/月**

---

### プラン別の超過コストまとめ表

| プラン | 全リソース超過に必要なアカウント数 | ストレージ超過 | 帯域幅超過 | データベース超過 | **1アカウントあたりの超過コスト/月** |
|--------|---------------------------|------------|----------|--------------|---------------------------|
| **Free** | 133アカウント | $0 | $0 | $0.0075 | **$0.000056** |
| **Light** | 21アカウント | $0 | $0 | $0.05 | **$0.00238** |
| **Pro** | 2アカウント | $0 | $0 | $0.95 | **$0.475** |
| **Admin** | 5アカウント | $0 | $0 | $0.1625 | **$0.0325** |

**注意事項:**
- 上記は、各プラン単独で全リソースを超過した場合のコストです
- 実際の超過コストは、プラン分布やアカウント数によって変動します
- **最大のボトルネックはデータベース容量**で、特にProプランが最も影響が大きい
- ストレージと帯域幅は、データベースがボトルネックになる時点ではまだ基本枠内です

---

### シナリオ別の計算（全プラン混合想定）

#### シナリオ1: 100アカウント（全プラン混合想定）

**想定プラン分布:**
- Free: 50アカウント
- Light: 30アカウント
- Pro: 18アカウント
- Admin: 2アカウント

**合計使用量:**
- **ストレージ**:
  - Free: 50 × 7MB = 350MB
  - Light: 30 × 22.5MB = 675MB
  - Pro: 18 × 225MB = 4,050MB (約4.05GB)
  - Admin: 2 × 425MB = 850MB
  - **合計**: 約6GB（基本枠100GB内）✅

- **帯域幅**:
  - Free: 50 × 0.05GB = 2.5GB
  - Light: 30 × 0.47GB = 14.1GB
  - Pro: 18 × 2.65GB = 47.7GB
  - Admin: 2 × 9.34GB = 18.68GB
  - **合計**: 約82.98GB（基本枠250GB内）✅

- **データベース**:
  - Free: 50 × 60.6MB = 3,030MB (約3.03GB)
  - Light: 30 × 400MB = 12,000MB (12GB)
  - Pro: 18 × 7.8GB = 140.4GB
  - Admin: 2 × 1.86GB = 3.72GB
  - **合計**: 約159.15GB（基本枠8GBを大幅に超過）❌

**超過コスト:**
- **データベース超過**: (159.15GB - 8GB) × $0.125 = **$18.89/月**
- **1アカウントあたり**: $18.89 / 100 = **$0.189/アカウント/月**

---

#### シナリオ2: 500アカウント（全プラン混合想定）

**想定プラン分布:**
- Free: 250アカウント
- Light: 150アカウント
- Pro: 90アカウント
- Admin: 10アカウント

**合計使用量:**
- **ストレージ**:
  - Free: 250 × 7MB = 1,750MB (約1.75GB)
  - Light: 150 × 22.5MB = 3,375MB (約3.38GB)
  - Pro: 90 × 225MB = 20,250MB (約20.25GB)
  - Admin: 10 × 425MB = 4,250MB (約4.25GB)
  - **合計**: 約29.63GB（基本枠100GB内）✅

- **帯域幅**:
  - Free: 250 × 0.05GB = 12.5GB
  - Light: 150 × 0.47GB = 70.5GB
  - Pro: 90 × 2.65GB = 238.5GB
  - Admin: 10 × 9.34GB = 93.4GB
  - **合計**: 約414.9GB（基本枠250GBを超過）❌

- **データベース**:
  - Free: 250 × 60.6MB = 15,150MB (約15.15GB)
  - Light: 150 × 400MB = 60,000MB (60GB)
  - Pro: 90 × 7.8GB = 702GB
  - Admin: 10 × 1.86GB = 18.6GB
  - **合計**: 約795.75GB（基本枠8GBを大幅に超過）❌

**超過コスト:**
- **帯域幅超過**: (414.9GB - 250GB) × $0.09 = **$14.84/月**
- **データベース超過**: (795.75GB - 8GB) × $0.125 = **$98.47/月**
- **合計超過**: **$113.31/月**
- **1アカウントあたり**: $113.31 / 500 = **$0.227/アカウント/月**

---

#### シナリオ3: 1000アカウント（全プラン混合想定）

**想定プラン分布:**
- Free: 500アカウント
- Light: 300アカウント
- Pro: 180アカウント
- Admin: 20アカウント

**合計使用量:**
- **ストレージ**:
  - Free: 500 × 7MB = 3,500MB (約3.5GB)
  - Light: 300 × 22.5MB = 6,750MB (約6.75GB)
  - Pro: 180 × 225MB = 40,500MB (約40.5GB)
  - Admin: 20 × 425MB = 8,500MB (約8.5GB)
  - **合計**: 約59.25GB（基本枠100GB内）✅

- **帯域幅**:
  - Free: 500 × 0.05GB = 25GB
  - Light: 300 × 0.47GB = 141GB
  - Pro: 180 × 2.65GB = 477GB
  - Admin: 20 × 9.34GB = 186.8GB
  - **合計**: 約829.8GB（基本枠250GBを大幅に超過）❌

- **データベース**:
  - Free: 500 × 60.6MB = 30,300MB (約30.3GB)
  - Light: 300 × 400MB = 120,000MB (120GB)
  - Pro: 180 × 7.8GB = 1,404GB
  - Admin: 20 × 1.86GB = 37.2GB
  - **合計**: 約1,591.5GB（基本枠8GBを大幅に超過）❌

**超過コスト:**
- **帯域幅超過**: (829.8GB - 250GB) × $0.09 = **$52.18/月**
- **データベース超過**: (1,591.5GB - 8GB) × $0.125 = **$197.94/月**
- **合計超過**: **$250.12/月**
- **1アカウントあたり**: $250.12 / 1000 = **$0.250/アカウント/月**

---

### プラン別の超過コスト寄与度分析

#### Proプランが最大の要因

上記の計算から、**データベース容量が最大のボトルネック**となっています。特にProプラン（365日の履歴保持）が主要因です。

**Proプラン（1アカウントあたり）:**
- **データベース**: 7.8GB/アカウント
- **超過料金寄与**: 7.8GB × $0.125 = **$0.975/アカウント/月**（基本枠8GBを考慮しない場合）

**Lightプラン（1アカウントあたり）:**
- **データベース**: 400MB/アカウント
- **超過料金寄与**: 0.4GB × $0.125 = **$0.05/アカウント/月**（基本枠8GBを考慮しない場合）

**Freeプラン（1アカウントあたり）:**
- **データベース**: 60.6MB/アカウント
- **超過料金寄与**: 0.0606GB × $0.125 = **$0.0076/アカウント/月**（基本枠8GBを考慮しない場合）

---

## 5. 1アカウントあたりの超過コストまとめ

### 基本枠を考慮した1アカウントあたりの超過コスト

**計算式:**
```
超過コスト = max(0, (合計使用量 - 基本枠) × 超過単価) / アカウント数
```

#### プラン別の超過コスト寄与度（アカウント数が増えた場合）

| プラン | データベース容量/アカウント | 超過コスト寄与度/アカウント/月 |
|--------|-------------------------|---------------------------|
| **Free** | 60.6MB | 約$0.008（1000アカウント時） |
| **Light** | 400MB | 約$0.05（1000アカウント時） |
| **Pro** | 7.8GB | 約$0.975（1000アカウント時） |
| **Admin** | 1.86GB（初年度） | 約$0.233（1000アカウント時） |

**注意**: 実際の超過コストは、アカウント数とプラン分布によって変動します。

---

## 6. 料金プラン設定の推奨

### 1アカウントあたりの想定コスト（超過分）

#### 保守的な見積もり（全プラン混合、1000アカウント時）
- **1アカウントあたりの超過コスト**: **約$0.25/月**

#### プラン別の推奨価格設定（超過コストを含む）

**基本方針:**
1. **Supabase基本料金（$25/月）**: サービス全体で負担
2. **超過コスト**: プランごとに転嫁
3. **マージン**: 運用コストとマージンを考慮

**推奨価格案:**

| プラン | 想定アカウント数 | 超過コスト/アカウント/月 | 推奨価格/月 | 備考 |
|--------|----------------|----------------------|----------|------|
| **Free** | 500（想定） | $0.008 | **¥0（無料）** | フリー・トライアル層 |
| **Light** | 300（想定） | $0.05 | **¥500-1,000** | 個人・小規模利用者 |
| **Pro** | 180（想定） | $0.975 | **¥5,000-10,000** | 企業・中規模利用者 |
| **Admin** | 20（想定） | $0.233（初年度） | **¥20,000-50,000** | 大規模・エンタープライズ |

**注意事項:**
- 実際の超過コストは、プラン分布と使用状況によって変動します
- Proプランの365日履歴保持が最大のコスト要因
- データベース容量の最適化（履歴保持期間の調整など）で超過コストを削減可能
- サービス規模が大きくなった場合、Supabase Teamプランへのアップグレードも検討

---

## 7. まとめ

### プラン別月額コスト（Supabase）

| プラン | Supabase料金 | ストレージ使用量 | 帯域幅使用量 | データベース容量 | 備考 |
|--------|-------------|----------------|------------|---------------|------|
| **Free** | **$0** | 7MB | 0.05GB | 60.6MB | 無料枠内で十分 |
| **Light** | **$0** | 22.5MB | 0.47GB | 400MB | Freeプランで十分 |
| **Pro** | **$25** | 225MB | 2.65GB | 7.8GB | データベース容量が大きい |
| **Admin** | **$25** | 425MB | 9.34GB | 1.86GB（初年度） | 中規模運用時は基本枠内 |

### 超過コストの傾向

1. **ストレージ**: 基本枠100GBで十分（1000アカウントでも約60GB）
2. **帯域幅**: 500アカウント以上で超過の可能性（Pro/Adminプランの影響が大きい）
3. **データベース**: **最も大きなボトルネック**（Proプランの365日履歴保持が主要因）

### プラン別の1アカウントあたりの超過コスト（全リソース超過時）

| プラン | 超過コスト/アカウント/月 | 主な要因 |
|--------|---------------------|---------|
| **Free** | **$0.000056** | データベース（133アカウントで超過） |
| **Light** | **$0.00238** | データベース（21アカウントで超過） |
| **Pro** | **$0.475** | データベース（2アカウントで超過） |
| **Admin** | **$0.0325** | データベース（5アカウントで超過） |

**最大の要因**: Proプランのデータベース容量（7.8GB/アカウント）が最も大きく、2アカウントで全リソースを超過します。

### コスト削減の実装済み施策

1. **✅ 画像の圧縮**: PNGからJPEG（品質80%）への変換で約50%のサイズ削減（実装済み）
2. **✅ 保存期間の制限**: プランごとに監視履歴の保存期間を設定し、古いデータを自動削除（実装済み）
   - Free: 30日
   - Light: 90日
   - Pro: 365日
3. **✅ 変更がない場合の画像削除**: 最新の1枚のみ保持し、古い画像は削除（実装済み）

### 追加のコスト削減提案

1. **データベース容量の最適化**: Proプランの履歴保持期間を365日から180日や90日に短縮することで、データベース容量を約50-75%削減可能
2. **監視履歴のアーカイブ化**: 古い監視履歴をSupabase StorageにJSON形式で保存し、データベースから削除
3. **プラン別の最適化**: 使用状況に応じて、プランごとの履歴保持期間を調整

### 注意事項

- **変更検出率10%は仮定値**：実際の使用状況によって変動
- **LP画像サイズは1.5MB（JPEG圧縮後）で見積もり**：実際のページの複雑さによって変動する可能性あり
- **保存画像は最新1枚のみ**：変更がない場合は古い画像は削除されるため、ストレージ使用量は抑えられる
- **初回登録時の画像保存を考慮**：LP/クリエイティブ登録時に必ず1枚の画像が保存される
- **データベース容量**：監視履歴の保存期間やデータ量によって変動。プランごとの履歴保持期間に応じて自動クリーンアップが実行される
- **JPEG圧縮の効果**：品質80%で約50%のサイズ削減を実現。品質とサイズのバランスが取れている
- **Proプランの履歴保持期間**：365日は他プランと比較して長く、データベース容量が大きくなる主な要因
