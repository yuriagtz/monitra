# プラン機能実装状況

## 実装済み機能

### 全プラン共通
- ✅ 自動変更検知（ファーストビュー、全体レイアウト）
- ✅ リンク切れチェック
- ✅ 分析レポート（グラフ、表）
- ✅ メール通知（SendGrid）
- ✅ カスタムスケジュール設定

### ライトプラン以上
- ✅ Slack通知（Webhook）
- ✅ Webhook通知（汎用）
- ✅ Chatwork通知（API）
- ✅ データエクスポート（CSV）
  - LPリスト
  - LP監視履歴
  - クリエイティブリスト
  - クリエイティブ監視履歴

## 未実装機能

以下の機能は現在未実装ですが、プラン比較表や料金カードに記載されています。

### 制限機能の実装が必要な項目

#### 1. データエクスポート（CSV）のプラン制限
- **現状**: 全プランで利用可能
- **要件**: ライトプラン以上のみ利用可能にする
- **実装箇所**:
  - `client/src/pages/ImportExport.tsx`: エクスポートボタンの無効化ロジック
  - `server/routers.ts` (importExport router): プランチェックの追加
- **実装方法**:
  ```typescript
  // server/routers.ts
  export: protectedProcedure
    .input(z.object({ type: z.string(), filename: z.string() }))
    .mutation(async ({ ctx, input }) => {
      const userPlan = (ctx.user.plan as "free" | "light" | "pro" | "admin") || "free";
      if (userPlan === "free") {
        throw new TRPCError({
          code: "FORBIDDEN",
          message: "データエクスポート機能はライトプラン以上でご利用いただけます。",
        });
      }
      // 既存のエクスポート処理
    }),
  ```

#### 2. 監視履歴の保存期間制限
- **現状**: 保存期間に基づいた自動削除機能は実装済み
- **要件**: プランに応じた保存期間の表示と通知
- **実装箇所**:
  - `server/cleanup.ts`: 既に実装済み（`historyRetentionDays`を使用）
  - ダッシュボードや設定画面での保存期間表示
- **実装方法**: 既に実装済み（`PLAN_CONFIG`の`historyRetentionDays`を使用）

#### 3. 手動監視実行回数の制限
- **現状**: 実装済み（`manualMonitoringQuota`テーブル、1時間制限、日次制限）
- **要件**: プランに応じた日次制限の表示
- **実装箇所**: 既に実装済み

### 削除が必要な項目

#### 1. PDFレポート生成
- **現状**: 機能は未実装だが、料金カードに記載されていた
- **対応**: 
  - ✅ プラン比較表から削除済み
  - ✅ 料金カードから削除済み
  - ✅ Featuresセクションの説明文を修正済み

#### 2. 優先サポート
- **現状**: 機能は未実装だが、料金カードに記載されていた
- **対応**: 
  - ✅ プラン比較表から削除済み
  - ✅ 料金カードから削除済み

### 今後の実装検討項目

以下の機能は現在実装されていませんが、将来的に追加する可能性があります。

#### 1. PDFレポート生成
- **概要**: 監視履歴や分析データをPDF形式でダウンロード
- **実装要素**:
  - PDF生成ライブラリ（例: `pdfkit`, `jspdf`）
  - レポートテンプレート設計
  - グラフ・表のPDF変換
- **優先度**: 低（プロプランの差別化要因として将来検討）

#### 2. 優先サポート
- **概要**: プロプランユーザー向けの優先的なサポートチャネル
- **実装要素**:
  - サポートチケットシステム
  - 優先度管理
  - チャット/メールサポート連携
- **優先度**: 低（サポート体制の整備が必要）

#### 3. 無料お試し期間
- **概要**: プロプランの30日間無料トライアル
- **実装要素**:
  - プラン変更時のトライアル期間管理
  - トライアル期限の通知
  - 自動ダウングレード機能
- **優先度**: 中（フリープランがあるため優先度は低め）

## プラン設定値（参考）

### フリープラン
- 月額料金: ¥0
- 最小監視間隔: 14日
- 最大LP登録数: 3ページ
- 最大クリエイティブ登録数: 10件
- 1日の手動監視実行回数: 5回
- 監視履歴の保存期間: 30日間
- データエクスポート: なし（実装必要）

### ライトプラン
- 月額料金: ¥980/月
- 最小監視間隔: 7日
- 最大LP登録数: 10ページ
- 最大クリエイティブ登録数: 30件
- 1日の手動監視実行回数: 50回
- 監視履歴の保存期間: 90日間
- データエクスポート: あり

### プロプラン
- 月額料金: ¥4,980/月
- 最小監視間隔: 3日
- 最大LP登録数: 100ページ
- 最大クリエイティブ登録数: 300件
- 1日の手動監視実行回数: 200回
- 監視履歴の保存期間: 365日間
- データエクスポート: あり

